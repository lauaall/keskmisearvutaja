<!-- Copyright (c) 2022 Aleks Tõnnus -->
<!DOCTYPE html>
<html lang="et">
<head>
    <title id="display">Kesmise arvutaja</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta description="Tasuta. Töötab kõikides brauserites. Lihtne kasutada.">
    <link rel="stylesheet" href="Stylesheet/style.css">
    <meta charset="utf-8">
</head>        
<body onload="visit()">
            <div class="black">
                <p id="text" class="text">Kopeeri siia hinded</p>
            </div> 
            <textarea title="Kirjuta siia 'tume', et muuta leht tumedaks" id="textfield" rows="5" cols="30">+1,-2,h,A,v,4/5,3*</textarea>
            <div class="added"><p id="text2" class="text2">⠀</p></div>
            <div class="button">
                <button id="button">Arvuta</button>  
                <button id="button2">Kustuta</button>
            </div>    

</body>
<script>
const body = document.querySelector("body");
body.style.color = "black";
var visited = localStorage.getItem("visitTimes");
function visit() {
    localStorage.setItem("visitTimes", ++visited);
}

function dark() {
        
    document.body.style.backgroundColor = "black";
        // make the text black
        document.getElementById("text").style.color = "white";
        document.getElementById("text2").style.color = "white";
        document.getElementById("textfield").style.color = "white";

        // make the buttons border white
        document.getElementById("button").style.borderColor = "white";
        document.getElementById("button2").style.borderColor = "white";
        document.getElementById("button3").style.borderColor = "white";
        document.getElementById("button4").style.borderColor = "white";
        document.getElementById("button5").style.borderColor = "white";
        // make button background black
        document.getElementById("button").style.backgroundColor = "black";
        document.getElementById("button2").style.backgroundColor = "black";
        document.getElementById("button3").style.backgroundColor = "black";
        document.getElementById("button4").style.backgroundColor = "black";
        document.getElementById("button5").style.backgroundColor = "black";
        textfield.style.backgroundColor = "black";
        // make button text white
        document.getElementById("button").style.color = "white";
        document.getElementById("button2").style.color = "white";
        document.getElementById("button3").style.color = "white";
        document.getElementById("button4").style.color = "white";
        document.getElementById("button5").style.color = "white";
        // change textfield title 
        document.getElementById("textfield").title = "Kirjuta siia 'tagasi', et minna tagasi oranzile";
}

const textfield = document.getElementById("textfield");
// if darkmode is true
if (localStorage.getItem("darkmode") == "true") {
    dark();
}

const button = document.getElementById("button");
const button2 = document.getElementById("button2");
const button3 = document.getElementById("button3");
const button4 = document.getElementById("button4");
const button5 = document.getElementById("button5");
const button6 = document.getElementById("button6");
const text2 = document.getElementById("text2");


// annoying buttons
button2.addEventListener("click", function(){
    textfield.value = "";
    text2.innerHTML = "";
    console.clear();
    console.log("reset")
});

button3.addEventListener("click", function(){
    localStorage.setItem("textfield", textfield.value);
    console.log("saved")
    const popup = document.createElement("div");
        popup.classList.add("popup");
        popup.innerHTML = "Salvestatud";
        document.body.appendChild(popup);
        setTimeout(function() {
            popup.remove();
        }, 3000);
});

button4.addEventListener("click", function(){
    textfield.value = localStorage.getItem("textfield");
    console.log("loaded")
});

button5.addEventListener("click", function(){
    localStorage.removeItem("textfield");
    console.log("removed")
    const popup = document.createElement("div");
        popup.classList.add("popup");
        popup.innerHTML = "Kustutatud";
        document.body.appendChild(popup);
        setTimeout(function() {
            popup.remove();
        }, 3000);
});

button.addEventListener("click", function() {
    if (textfield.value == "tagasi" || textfield.value == "Tagasi"){
        localStorage.setItem("darkmode", false)
        location.reload();
    }
});

    

button.addEventListener("click", function() {
    if (textfield.value == "tume" || textfield.value == "Tume"){
        localStorage.setItem("darkmode", true)
            dark();
    }
});


button.addEventListener("click", function() {
        // if text field value is snake start snake game
        if (textfield.value == "snake") {
        window.location.href = "snake.html";
    }
console.clear();
var str = textfield.value;
// no idea why this is here lol
var remove = str.replace(/^\d+\,\d+\,/g, "");
var str2 = str.replace(/[^0-5]/g, '');
var arr = str2.split('');
var sum = arr.reduce((a, b) => parseInt(a) + parseInt(b));
var avg = sum / arr.length;
var rounded = Math.round(avg);
var arrlen = arr.length;
// if avg is already rounded dont add (-na ümardatud)
if (rounded == avg) {
    text2.innerHTML = "Keskmine on " + avg;
} else {
    text2.innerHTML = "Keskmine on " + avg + " \n(" + rounded + "-na ümardatud)\n" + "\n (" + arrlen + " hinnet)";
}});
</script>
</html>